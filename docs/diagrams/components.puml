@startuml components
title диаграмма компонентов
skinparam componentStyle rectangle
skinparam shadowing false

package "Приложение CLI" {
  [CLI] as CLI
  [Expander] as Expander
  [Tokenizer] as Lexer
  [Parser] as Parser
  [Executor] as Executor
  [Environment] as Env
  [CommandRegistry] as Registry
  [Builtins] as Builtins
  [Запуск внешних программ] as External
}
 CLI --> Expander : исходная строка (raw line)
Expander --> Lexer : строка после подстановок\n+ служебные маркеры "единый аргумент"
Lexer --> Parser : токены
Parser --> Executor : AST / Exec-модель
 CLI --> Env : чтение/обновление переменных
Expander --> Env : чтение значений $NAME
Executor --> Env : формирование окружения\nдля дочерних процессов

Executor --> Registry : это builtin?
Registry --> Builtins : найти/выполнить
Executor --> External : fork/exec\n(если команда неизвестна)

note right of Lexer
Lexer понимает кавычки и оператор |.

Дополнительно: Lexer понимает служебные маркеры,
которые означают "пробелы внутри — часть одного слова".
end note

note right of Executor
Пайплайн реализуется средствами ОС:
pipe(), fork(), dup2(), execvp(), waitpid().

Встроенные команды запускаются в дочернем процессе,
чтобы корректно работать в пайплайне.
end note

@enduml